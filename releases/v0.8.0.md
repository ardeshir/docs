# DOL v0.8.0 Release Notes

**Release Date:** January 17, 2025
**Codename:** Clarity

---

## Overview

DOL v0.8.0 "Clarity" is a major release that modernizes the language syntax to align with Rust conventions. This release introduces new preferred keywords and type names while maintaining full backward compatibility through deprecation warnings.

---

## Language Changes

### New Preferred Keywords

| Old Keyword | New Keyword | Purpose |
|-------------|-------------|---------|
| `gene` | `gen` | Genome/type declarations |
| `constraint` | `rule` | Constraint declarations |
| `evolves` | `evo` | Evolution declarations |
| `exegesis` | `docs` | Documentation blocks |

**Example:**

```dol
// v0.8.0 syntax
gen Container {
    docs { A container holding items }

    has capacity: i32
    has items: Vec<string>
}

rule CapacityLimit {
    docs { Ensure capacity is positive }

    this.capacity > 0
}

evo Container from 0.1.0 to 0.2.0 {
    docs { Add max_size field }

    adds field max_size: i64
}
```

### Modernized Type Names (Rust-aligned)

| Old Type | New Type | Description |
|----------|----------|-------------|
| `String` | `string` | UTF-8 string |
| `Bool` | `bool` | Boolean |
| `Int8`...`Int64` | `i8`...`i64` | Signed integers |
| `UInt8`...`UInt64` | `u8`...`u64` | Unsigned integers |
| `Float32`, `Float64` | `f32`, `f64` | Floating point |
| `Void` | `()` | Unit type |
| `List<T>` | `Vec<T>` | Vector/list |
| `Optional<T>` | `Option<T>` | Optional value |

### Deprecation Timeline

- **v0.8.0**: Old syntax deprecated, warnings emitted
- **v0.9.0**: Warnings become errors in strict mode
- **v1.0.0**: Old syntax removed completely

---

## New Features

### Tree Shaking

Dead code elimination for smaller output:

```bash
# Enable tree shaking
dol-parse --tree-shake example.dol

# Specify additional root declarations
dol-parse --tree-shake --roots main,init example.dol

# Preview eliminations (dry run)
dol-parse --shake-analyze example.dol
```

The tree shaker:
- Analyzes dependency graphs to identify unreachable declarations
- Preserves public declarations and their transitive dependencies
- Reports eliminated declarations in all output formats

### Migration Tool

Automatic syntax migration from v0.7.x to v0.8.0:

```bash
# Migrate a directory
dol-migrate 0.7-to-0.8 src/

# Preview changes
dol-migrate 0.7-to-0.8 --diff src/

# Dry run (no file changes)
dol-migrate 0.7-to-0.8 --dry-run src/

# Include return statement modernization
dol-migrate 0.7-to-0.8 --modernize src/
```

### WASM Feature Split

The WASM feature is now split for better flexibility:

```bash
# Browser-compatible compile-only
cargo build --features wasm-compile

# Full runtime (requires native dependencies)
cargo build --features wasm-runtime

# Both
cargo build --features wasm
```

---

## Improvements

### Spirit REPL Architecture

Design documentation for the DOL → Rust → WASM pipeline in a REPL environment.

### Module and Spirits Test Suite

Comprehensive test coverage for the module and spirits system.

---

## Migration Guide

### Automatic Migration

```bash
# Step 1: Preview changes
cargo run --bin dol-migrate --features cli -- 0.7-to-0.8 --diff src/

# Step 2: Apply migration
cargo run --bin dol-migrate --features cli -- 0.7-to-0.8 src/

# Step 3: Verify
cargo run --bin dol-check --features cli -- src/
```

### Manual Migration

1. Replace `gene` with `gen`
2. Replace `constraint` with `rule`
3. Replace `evolves` with `evo`
4. Replace `exegesis` with `docs`
5. Update type names to lowercase variants
6. Replace `List<T>` with `Vec<T>`
7. Replace `Optional<T>` with `Option<T>`
8. Replace `Void` with `()`

---

## Backward Compatibility

All v0.8.0 changes are **fully backward compatible**:

- Old syntax continues to work
- Deprecation warnings guide users to new syntax
- AST normalizes old types to new equivalents
- No breaking changes in parser API

---

## PRs Merged

- #17 - feature/design-docs: Spirit REPL architecture documentation
- #18 - feat(wasm): Split WASM feature into browser-compatible compile and native runtime

---

## Installation

```bash
# From crates.io
cargo install metadol --version 0.8.0

# With CLI tools
cargo install metadol --version 0.8.0 --features cli

# From source
git checkout v0.8.0
cargo build --release --features cli
```

---

## Links

- [GitHub Release](https://github.com/univrs/dol/releases/tag/v0.8.0)
- [Migration Guide](https://learn.univrs.io/dol/migration/0.8)
- [Parser Changes Documentation](../dol/v0.8.0_PARSER_CHANGES.md)
- [Changelog](../CHANGELOG.md)
